{% extends "base.html" %}
{% load static %}
{% block title %}Get a Quote | MPE UK Ltd{% endblock %}
{% block content %}
<section class="simple-hero">
  <div class="container">
    <h1>Get a Quote</h1>
    <p class="muted">Tell us about your packaging requirements and we'll help you find the perfect solution.</p>
  </div>
</section>

<section class="simple-section">
  <div class="container">
    <div style="display:grid; grid-template-columns:repeat(12, 1fr); gap:24px; align-items:start;">
      
      <!-- Contact Form -->
      <div class="card" style="grid-column:span 8;">
        <div class="card__pad" style="padding:32px;">
          <div style="margin-bottom:28px;">
            <h2 style="margin:0 0 8px 0; color:var(--brand); font-size:1.5rem; font-weight:700;">Request a Quote</h2>
            <p class="muted" style="margin:0;">Fill out the form below and our team will get back to you within 24 hours.</p>
          </div>

          <div id="contact-status" style="display:none; margin-bottom:16px; padding:12px 14px; border:1px solid var(--border); border-radius:var(--radius-sm);"></div>

          <form id="contact-form" method="post" action="{% url 'contact_submit' %}" style="display:grid; gap:20px;">
            {% csrf_token %}
            <input type="hidden" name="machine" value="{{ request.GET.machine|default:'' }}">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
              <div>
                <label style="display:block; margin-bottom:8px; font-weight:600; color:var(--text); font-size:.9rem;">
                  <i class="fa-solid fa-user" style="color:var(--brand2); margin-right:6px;"></i>Full Name *
                </label>
                <input type="text" name="name" required 
                       style="width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:.95rem;"
                       placeholder="John Smith">
              </div>
              <div>
                <label style="display:block; margin-bottom:8px; font-weight:600; color:var(--text); font-size:.9rem;">
                  <i class="fa-solid fa-building" style="color:var(--brand2); margin-right:6px;"></i>Company
                </label>
                <input type="text" name="company" 
                       style="width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:.95rem;"
                       placeholder="Your Company Ltd">
              </div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
              <div>
                <label style="display:block; margin-bottom:8px; font-weight:600; color:var(--text); font-size:.9rem;">
                  <i class="fa-solid fa-envelope" style="color:var(--brand2); margin-right:6px;"></i>Email Address *
                </label>
                <input type="email" name="email" required 
                       style="width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:.95rem;"
                       placeholder="john@company.com">
              </div>
              <div>
                <label style="display:block; margin-bottom:8px; font-weight:600; color:var(--text); font-size:.9rem;">
                  <i class="fa-solid fa-phone" style="color:var(--brand2); margin-right:6px;"></i>Phone Number
                </label>
                <input type="text" name="phone" 
                       style="width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:.95rem;"
                       placeholder="+44 1234 567890">
              </div>
            </div>

            <div>
              <label style="display:block; margin-bottom:8px; font-weight:600; color:var(--text); font-size:.9rem;">
                <i class="fa-solid fa-box" style="color:var(--brand2); margin-right:6px;"></i>What are you packing?
              </label>
              <input type="text" name="product" 
                     style="width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:.95rem;"
                     placeholder="e.g. Sandwiches, salads, ready meals...">
            </div>

            <div>
              <label style="display:block; margin-bottom:8px; font-weight:600; color:var(--text); font-size:.9rem;">
                <i class="fa-solid fa-gauge-high" style="color:var(--brand2); margin-right:6px;"></i>Required Output
              </label>
              <input type="text" name="output" 
                     style="width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:.95rem;"
                     placeholder="e.g. 60 packs per minute">
            </div>

            <div>
              <label style="display:block; margin-bottom:8px; font-weight:600; color:var(--text); font-size:.9rem;">
                <i class="fa-solid fa-message" style="color:var(--brand2); margin-right:6px;"></i>Additional Details
              </label>
              <textarea name="message" rows="5"
                        style="width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:.95rem; resize:vertical;"
                        placeholder="Tell us more about your requirements, timeline, or any specific questions..."></textarea>
            </div>

            <button type="submit" class="btn btn--primary" style="width:100%;">
              <i class="fa-solid fa-paper-plane"></i>
              <span>Send Quote Request</span>
            </button>
          </form>

          <p class="muted" style="margin:20px 0 0 0; font-size:.85rem; text-align:center;">
            <i class="fa-solid fa-lock" style="color:var(--brand2);"></i> 
            Your information is secure and will only be used to respond to your inquiry.
          </p>
        </div>
      </div>

      <!-- Contact Information Sidebar -->
      <div style="grid-column:span 4; display:grid; gap:20px;">
        <div class="card">
          <div class="card__pad">
            <h3 style="margin:0 0 16px 0; color:var(--brand); font-size:1.15rem; font-weight:700;">
              <i class="fa-solid fa-headset" style="color:var(--brand2); margin-right:8px;"></i>
              Contact Us Directly
            </h3>
            <div style="display:grid; gap:14px;">
              <a href="tel:+441663732700" class="link" style="display:flex; align-items:center; gap:10px;">
                <i class="fa-solid fa-phone"></i>
                <span>+44 1663 732700</span>
              </a>
              <a href="mailto:sales@mpe-uk.com" class="link" style="display:flex; align-items:center; gap:10px;">
                <i class="fa-solid fa-envelope"></i>
                <span>sales@mpe-uk.com</span>
              </a>
              <div style="display:flex; align-items:start; gap:10px; color:var(--muted);">
                <i class="fa-solid fa-location-dot" style="color:var(--brand2); margin-top:2px;"></i>
                <span>Derbyshire, United Kingdom</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card__pad">
            <h3 style="margin:0 0 16px 0; color:var(--brand); font-size:1.15rem; font-weight:700;">
              <i class="fa-solid fa-clock" style="color:var(--brand2); margin-right:8px;"></i>
              Office Hours
            </h3>
            <div style="display:grid; gap:10px; color:var(--muted); font-size:.9rem;">
              <div style="display:flex; justify-content:space-between;">
                <span style="font-weight:600;">Monday - Friday</span>
                <span>9:00 - 17:00</span>
              </div>
              <div style="display:flex; justify-content:space-between;">
                <span style="font-weight:600;">Weekend</span>
                <span>Closed</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card" style="background:linear-gradient(135deg, var(--brand2) 0%, var(--accent) 100%); border:none;">
          <div class="card__pad">
            <h3 style="margin:0 0 12px 0; color:#fff; font-size:1.1rem; font-weight:700;">
              <i class="fa-solid fa-bolt" style="margin-right:8px;"></i>
              Fast Response
            </h3>
            <p style="margin:0; color:rgba(255,255,255,.95); font-size:.9rem; line-height:1.6;">
              We typically respond to quote requests within 24 hours during business days.
            </p>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<style>
  @media (max-width: 980px){
    #contact-form > div[style*="grid-template-columns:1fr 1fr"]{
      grid-template-columns: 1fr !important;
    }
  }
  @media (max-width: 640px){
    .simple-section [style*="grid-column:span 8"],
    .simple-section [style*="grid-column:span 4"]{
      grid-column: span 12 !important;
    }
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  document.getElementById('contact-form').addEventListener('submit', function(e) {
    e.preventDefault();

    const form = e.target;
    const btn = form.querySelector('button[type="submit"]');
    const status = document.getElementById('contact-status');
    const originalContent = btn.innerHTML;

    status.style.display = 'none';
    status.textContent = '';

    btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i><span>Sending...</span>';
    btn.disabled = true;

    const formData = new FormData(form);

    fetch(form.action, {
      method: 'POST',
      body: formData,
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      },
      credentials: 'same-origin'
    })
    .then(async (resp) => {
      let data = {};
      try { data = await resp.json(); } catch(e) {}
      if (!resp.ok || !data.ok) {
        const msg = (data && data.error) ? data.error : 'Sorry — we could not send your request right now. Please email sales@mpe-uk.com.';
        throw new Error(msg);
      }

      status.style.display = 'block';
      status.style.background = 'rgba(40,167,69,.08)';
      status.style.borderColor = 'rgba(40,167,69,.35)';
      status.style.color = 'var(--text)';
      status.innerHTML = '<strong>Thank you.</strong> Your quote request has been sent. We will be in touch soon.';
      form.reset();
    })
    .catch((err) => {
      status.style.display = 'block';
      status.style.background = 'rgba(220,53,69,.08)';
      status.style.borderColor = 'rgba(220,53,69,.35)';
      status.style.color = 'var(--text)';
      status.textContent = err.message || 'Sorry — we could not send your request right now.';
    })
    .finally(() => {
      btn.innerHTML = originalContent;
      btn.disabled = false;
    });
  });
</script>
{% endblock %}
