{% extends "base.html" %}
{% load static %}

{% block title %}{{ machine.name }} | MPE UK Ltd{% endblock %}

{% block extra_head %}
  {{ block.super }}
  <!-- Tailwind (CDN for now) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Inter font for modern SaaS-style typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Admin-controlled scheme (SiteConfiguration) */
      --primary-color: {{ site_config.primary_color|default:"#1f9d55" }};
      --primary-contrast: #ffffff;

      --hero-bg: {{ site_config.hero_bg_color|default:"#001a4d" }};
      --hero-fg: {{ site_config.hero_text_color|default:"#ffffff" }};

      --page-bg: {{ site_config.site_bg_color|default:"#f7f8fb" }};
      --surface: {{ site_config.card_bg_color|default:"#ffffff" }};
      --text: {{ site_config.site_text_color|default:"#0f172a" }};
      --card-text: {{ site_config.card_text_color|default:"#0f172a" }};

      /* Safe defaults (not currently admin fields) */
      --muted: rgba(15, 23, 42, 0.70);
      --border-color: rgba(15, 23, 42, 0.10);

      /* Soft shadows (modern, not muddy) */
      --shadow-sm: 0 1px 2px rgba(2, 6, 23, 0.06);
      --shadow-md: 0 12px 32px rgba(2, 6, 23, 0.10);
      --shadow-lg: 0 24px 70px rgba(2, 6, 23, 0.18);

      --radius: 18px;
      --radius-lg: 24px;
    }

    /* Typography */
    html, body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; }

    /* Card */
    .mp-card{
      background: var(--surface);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
    }
    .mp-card-hover{
      transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
    }
    .mp-card-hover:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      border-color: rgba(2, 6, 23, 0.16);
    }

    /* Buttons */
    .mp-btn-primary{
      background: var(--primary-color);
      color: var(--primary-contrast);
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: 0 10px 22px rgba(2, 6, 23, 0.18);
      transition: transform 160ms ease, filter 160ms ease, box-shadow 160ms ease;
    }
    .mp-btn-primary:hover{ filter: brightness(1.03); transform: translateY(-1px); box-shadow: 0 14px 28px rgba(2, 6, 23, 0.22); }
    .mp-btn-primary:active{ transform: translateY(0); }

    .mp-btn-ghost{
      background: rgba(255,255,255,0.06);
      color: var(--hero-fg);
      border: 1px solid rgba(255,255,255,0.12);
      transition: transform 160ms ease, background 160ms ease;
    }
    .mp-btn-ghost:hover{ background: rgba(255,255,255,0.10); transform: translateY(-1px); }
    .mp-btn-ghost:active{ transform: translateY(0); }

    /* Hero glow (immersive, no white ‚Äúimage box‚Äù) */
    .mp-hero-glow{
      background:
        radial-gradient(900px 420px at 70% 25%, rgba(255,255,255,0.14), transparent 60%),
        radial-gradient(650px 360px at 20% 15%, rgba(255,255,255,0.08), transparent 55%),
        linear-gradient(135deg, rgba(255,255,255,0.05), transparent 40%),
        linear-gradient(180deg, rgba(255,255,255,0.02), transparent 45%);
    }
  </style>
{% endblock %}

{% block content %}

  <!-- HERO -->
  <header class="relative overflow-hidden bg-[var(--hero-bg)] text-[var(--hero-fg)]">
    <div class="absolute inset-0 mp-hero-glow"></div>
    <div class="absolute inset-0 opacity-60"
         style="background:
           radial-gradient(900px 500px at 80% 20%, rgba(255,255,255,0.10), transparent 60%),
           radial-gradient(700px 420px at 15% 35%, rgba(255,255,255,0.06), transparent 60%);">
    </div>

    <div class="relative mx-auto max-w-7xl px-6 py-10 lg:py-14">
      <!-- Breadcrumb / top actions -->
      <div class="flex items-center justify-between gap-4">
        <a href="{% url 'machines_list' %}"
           class="inline-flex items-center gap-2 text-sm text-white/70 hover:text-white transition rounded-md px-1 py-1">
          <span aria-hidden="true">‚Üê</span>
          <span>Machines</span>
        </a>

        <div class="hidden sm:flex items-center gap-3">
          <a href="{% url 'contact' %}?machine={{ machine.slug|urlencode }}"
             class="mp-btn-primary inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-semibold">
            Get a quote <span aria-hidden="true">‚Üí</span>
          </a>
        </div>
      </div>

      <div class="mt-8 grid grid-cols-1 lg:grid-cols-12 gap-8 items-center">
        <!-- Copy -->
        <div class="lg:col-span-6">
          <p class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium"
             style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.14);">
            {{ machine.tagline|default:"Industrial Machine" }}
          </p>

          <h1 class="mt-4 text-4xl sm:text-5xl font-semibold tracking-tight">
            {{ machine.hero_title|default:machine.name }}
          </h1>

          {% if machine.hero_subtitle %}
            <p class="mt-3 text-lg text-white/75 max-w-xl">
              {{ machine.hero_subtitle }}
            </p>
          {% elif machine.description %}
            <p class="mt-3 text-lg text-white/75 max-w-xl">
              {{ machine.description|truncatechars:180 }}
            </p>
          {% endif %}

          <!-- CTA row -->
          <div class="mt-7 flex flex-wrap items-center gap-3">
            <a href="{% url 'contact' %}?machine={{ machine.slug|urlencode }}"
               class="mp-btn-primary inline-flex items-center justify-center rounded-xl px-5 py-3 text-sm font-semibold">
              Get a quote
            </a>

            {% if machine.spec_pdf %}
              <a href="{{ machine.spec_pdf.url }}"
                 class="mp-btn-ghost inline-flex items-center justify-center rounded-xl px-5 py-3 text-sm font-semibold"
                 target="_blank" rel="noopener">
                Spec sheet
              </a>
            {% endif %}
          </div>

          <!-- Meta line -->
          <div class="mt-6 flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-white/70">
            {% if site_config.feature_1 %}<span>{{ site_config.feature_1 }}</span>{% endif %}
            {% if site_config.feature_2 %}<span>{{ site_config.feature_2 }}</span>{% endif %}
            {% if site_config.feature_3 %}<span>{{ site_config.feature_3 }}</span>{% endif %}
          </div>
        </div>

        <!-- Image -->
        <div class="lg:col-span-6">
          <div class="relative">
            <div class="absolute -inset-6 rounded-[28px]"
                 style="background: radial-gradient(closest-side, rgba(255,255,255,0.10), transparent 70%);">
            </div>

            <div class="relative flex justify-center lg:justify-end">
              {% if machine.hero_image %}
                <img
                  src="{{ machine.hero_image.url }}"
                  alt="{{ machine.name }}"
                  class="w-full max-w-[640px] object-contain drop-shadow-[0_40px_80px_rgba(2,6,23,0.35)]"
                  loading="eager"
                />
              {% elif machine.image %}
                <img
                  src="{{ machine.image.url }}"
                  alt="{{ machine.name }}"
                  class="w-full max-w-[640px] object-contain drop-shadow-[0_40px_80px_rgba(2,6,23,0.35)]"
                  loading="eager"
                />
              {% else %}
                <div class="w-full max-w-[640px] rounded-[28px] border border-white/10 p-10 text-center text-white/70"
                     style="background: rgba(255,255,255,0.06);">
                  Add a transparent PNG hero image in the admin for best results.
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile CTA -->
      <div class="mt-8 sm:hidden">
        <a href="{% url 'contact' %}?machine={{ machine.slug|urlencode }}"
           class="mp-btn-primary w-full inline-flex items-center justify-center rounded-xl px-5 py-3 text-sm font-semibold">
          Get a quote
        </a>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="mx-auto max-w-7xl px-6 py-10 lg:py-14" style="color: var(--text);">
    <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
      <div>
        <h2 class="text-2xl font-semibold tracking-tight">{{ machine.overview_title|default:"Overview" }}</h2>
        <p class="mt-2 text-sm" style="color: var(--muted);">
          A clear summary of capabilities, options and commercial context.
        </p>
      </div>

      <div class="flex flex-wrap gap-3">
        {% if machine.spec_pdf %}
          <a href="{{ machine.spec_pdf.url }}"
             class="inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-semibold border"
             style="background: var(--surface); border-color: var(--border-color); color: var(--text); box-shadow: var(--shadow-sm);"
             target="_blank" rel="noopener">
            <span aria-hidden="true">üìÑ</span>
            Download spec sheet
          </a>
        {% endif %}

        <a href="{% url 'contact' %}?machine={{ machine.slug|urlencode }}"
           class="mp-btn-primary inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-semibold">
          Get a quote <span aria-hidden="true">‚Üí</span>
        </a>
      </div>
    </div>

    <div class="mt-8 grid grid-cols-1 lg:grid-cols-12 gap-7">
      <!-- Left: Overview + Videos -->
      <section class="lg:col-span-8 space-y-7">
        <div class="mp-card mp-card-hover p-6 sm:p-7">
          {% if machine.overview_body %}
            <p class="text-base leading-relaxed" style="color: var(--card-text);">
              {{ machine.overview_body|linebreaksbr }}
            </p>
          {% elif machine.description %}
            <p class="text-base leading-relaxed" style="color: var(--card-text);">
              {{ machine.description|linebreaksbr }}
            </p>
          {% else %}
            <p class="text-base leading-relaxed" style="color: var(--muted);">
              Add overview text in the admin (overview_body) to populate this section.
            </p>
          {% endif %}

          {% if machine.key_features %}
            <div class="mt-6">
              <h3 class="text-sm font-semibold tracking-wide uppercase" style="color: var(--muted);">
                Key features
              </h3>
              <ul class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
                {% for line in machine.key_features.splitlines %}
                  {% if line %}
                    <li class="rounded-xl border px-4 py-3"
                        style="background: rgba(2,6,23,0.03); border-color: var(--border-color);">
                      <div class="text-sm font-semibold" style="color: var(--card-text);">{{ line }}</div>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </div>

        {% if machine.videos.all %}
          <div class="mp-card p-6 sm:p-7">
            <div class="flex items-center justify-between gap-4">
              <h3 class="text-lg font-semibold">Videos</h3>
              <p class="text-sm" style="color: var(--muted);">Demonstrations and real-world use.</p>
            </div>

            <div class="mt-5 grid grid-cols-1 md:grid-cols-2 gap-5">
              {% for v in machine.videos.all %}
                <div class="mp-card-hover rounded-[var(--radius)] overflow-hidden border"
                     style="border-color: var(--border-color); background: var(--surface); box-shadow: var(--shadow-sm);">
                  <div class="relative w-full" style="padding-top:56.25%; background: #000;">
                    {% if v.embed_url %}
                      <iframe class="absolute inset-0 w-full h-full"
                              src="{{ v.embed_url }}"
                              title="{{ v.title|default:machine.name }}"
                              frameborder="0"
                              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                              allowfullscreen></iframe>
                    {% elif v.video_url %}
                      <iframe class="absolute inset-0 w-full h-full"
                              src="{{ v.video_url }}"
                              title="{{ v.title|default:machine.name }}"
                              frameborder="0"
                              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                              allowfullscreen></iframe>
                    {% else %}
                      <div class="absolute inset-0 flex items-center justify-center text-sm text-white/70">
                        No embed URL set for this video.
                      </div>
                    {% endif %}
                  </div>

                  <div class="p-4">
                    <div class="text-sm font-semibold">{{ v.title|default:"Video" }}</div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </section>

      <!-- Right: Documents + CTA -->
      <aside class="lg:col-span-4 space-y-7">
        <div class="mp-card mp-card-hover p-6">
          <h3 class="text-lg font-semibold">Get pricing & configuration</h3>
          <p class="mt-2 text-sm" style="color: var(--muted);">
            Tell us your tray size, film type and target throughput ‚Äî we‚Äôll respond with a configuration and quote.
          </p>

          <div class="mt-5 flex flex-col gap-3">
            <a href="{% url 'contact' %}?machine={{ machine.slug|urlencode }}"
               class="mp-btn-primary inline-flex items-center justify-center rounded-xl px-4 py-3 text-sm font-semibold">
              Get a quote
            </a>

            {% if site_config.email %}
              <a href="mailto:{{ site_config.email }}?subject={{ machine.name|urlencode }}%20enquiry"
                 class="inline-flex items-center justify-center rounded-xl px-4 py-3 text-sm font-semibold border"
                 style="background: var(--surface); border-color: var(--border-color); color: var(--text);">
                Email sales
              </a>
            {% endif %}
          </div>
        </div>

        <div class="mp-card mp-card-hover p-6">
          <div class="flex items-center justify-between gap-4">
            <h3 class="text-lg font-semibold">Related documents</h3>
            <span class="text-sm" style="color: var(--muted);">Downloads</span>
          </div>

          <div class="mt-4 space-y-3">
            {% if machine.spec_pdf %}
              <a href="{{ machine.spec_pdf.url }}"
                 class="group flex items-center justify-between gap-4 rounded-xl border px-4 py-3"
                 style="background: rgba(2,6,23,0.03); border-color: var(--border-color);"
                 target="_blank" rel="noopener">
                <div class="flex items-center gap-3">
                  <div class="h-10 w-10 rounded-xl flex items-center justify-center"
                       style="background: rgba(2,6,23,0.06);">
                    <span aria-hidden="true">üìÑ</span>
                  </div>
                  <div>
                    <div class="text-sm font-semibold">Spec sheet</div>
                    <div class="text-xs" style="color: var(--muted);">PDF download</div>
                  </div>
                </div>
                <div class="text-sm font-semibold" style="color: var(--primary-color);">Download ‚Üí</div>
              </a>
            {% endif %}

            {% if machine.documents.all %}
              {% for doc in machine.documents.all %}
                {% if doc.file or doc.url %}
                  <a href="{% if doc.file %}{{ doc.file.url }}{% else %}{{ doc.url }}{% endif %}"
                     class="group flex items-center justify-between gap-4 rounded-xl border px-4 py-3"
                     style="background: rgba(2,6,23,0.03); border-color: var(--border-color);"
                     target="_blank" rel="noopener">
                    <div class="flex items-center gap-3">
                      <div class="h-10 w-10 rounded-xl flex items-center justify-center"
                           style="background: rgba(2,6,23,0.06);">
                        <span aria-hidden="true">üìé</span>
                      </div>
                      <div>
                        <div class="text-sm font-semibold">{{ doc.title|default:"Document" }}</div>
                        <div class="text-xs" style="color: var(--muted);">Download</div>
                      </div>
                    </div>
                    <div class="text-sm font-semibold" style="color: var(--primary-color);">Download ‚Üí</div>
                  </a>
                {% endif %}
              {% endfor %}
            {% endif %}

            {% if not machine.spec_pdf and not machine.documents.all %}
              <div class="rounded-xl border px-4 py-4 text-sm" style="background: rgba(2,6,23,0.03); border-color: var(--border-color); color: var(--muted);">
                No documents have been added yet.
              </div>
            {% endif %}
          </div>
        </div>
      </aside>
    </div>
  </main>

{% endblock %}
