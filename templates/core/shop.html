{% extends "base.html" %}
{% load static %}

{% block title %}Shop | MPE UK Ltd{% endblock %}

{% block content %}
<section class="simple-hero">
  <div class="container">
    <h1>Shop</h1>
    <p class="muted">Browse products.</p>
  </div>
</section>

<section class="simple-section">
  <div class="container">
    <div class="grid machine-grid" id="shop-grid"></div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
(async function(){
  const grid = document.getElementById("shop-grid");
  if (!grid) return;

  let products = [];
  try {
    const res = await fetch("{% url 'api_products' %}");
    products = await res.json();
  } catch (e) {}

  function card(p){
    const img = p.image_url || "{% static 'assets/image-coming-soon.png' %}";
    const priceHtml = p.price !== null
      ? `<span style="font-weight:800; color:var(--brand);">Â£${p.price.toFixed(2)}</span>`
      : `<span class="muted" style="font-weight:700;">Price on request</span>`;

    return `
      <article class="card machine">
        <a class="thumb" href="${p.detail_url}">
          <img src="${img}" alt="${p.name}">
        </a>
        <div class="card__pad">
          <h3>${p.name}</h3>
          <p class="muted">${p.description || ""}</p>
          <div style="display:flex; justify-content:space-between; align-items:center;">
            ${priceHtml}
            <a href="${p.detail_url}" class="btn btn--primary">View</a>
          </div>
        </div>
      </article>
    `;
  }

  grid.innerHTML = products.map(card).join("");
})();
</script>
{% endblock %}
